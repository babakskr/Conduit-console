name: ci-bash

on:
  push:
  pull_request:

permissions:
  contents: read

jobs:
  bash-sanity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Bash syntax check
        shell: bash
        run: |
          set -euo pipefail
          shopt -s globstar nullglob
          for f in **/*.sh; do
            echo "Checking syntax: $f"
            bash -n "$f"
          done

      - name: Help standard check (-h)
        shell: bash
        run: |
          set -euo pipefail
          for f in conduit-console.sh conduit-optimizer.sh; do
            if [[ -f "$f" ]]; then
              echo "Checking help for: $f"
              out="$("./$f" -h 2>/dev/null || true)"
              [[ -n "$out" ]] || { echo "Missing -h output in $f"; exit 1; }
              echo "$out" | grep -qi "Usage" || { echo "Help missing Usage in $f"; exit 1; }
              echo "$out" | grep -qi "Options" || { echo "Help missing Options in $f"; exit 1; }
              echo "$out" | grep -qi "Example" || { echo "Help missing Examples in $f"; exit 1; }
            fi
          done
